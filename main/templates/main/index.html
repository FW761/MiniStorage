{% extends 'main/base_template.html' %}

{% block message %}
    <div class="modal" id="message-block" style="display: none">
        <div>
            <div>
                <span class="span-button" id="message-block-close-button">X</span>
            </div>
            <div>
                <p></p>
            </div>
            <div>
                <span class="span-button" id="message-block-ok-button">Ок</span>
            </div>
        </div>
    </div>

    <script>
        function showMessage(msg) {
            let $messageBlock = $("#message-block");
            showModal($messageBlock);
            $("p", $messageBlock).text(msg);
        }

        function showAjaxError(jqXHR, $modal) {
            closeModal($modal);
            let errorText;
            if ('responseText' in jqXHR) {
                if (jqXHR.status >= 500) {
                    errorText = `(${jqXHR.status}. ${jqXHR.statusText}) Внутренняя ошибка сервера`;
                } else {
                    let responseObj = JSON.parse(jqXHR.responseText);
                    let errors = [];
                    for (let key of Object.keys(responseObj)) {
                        errors.push(responseObj[key]);
                    }
                    errorText = `(${jqXHR.status}. ${jqXHR.statusText}) ${errors.join(" ")}`;
                }
            } else {
                errorText = "Сервер не доступен...";
            }
            showMessage(errorText);
        }

        $("#message-block-close-button, #message-block-ok-button").click(() => {
            closeModal($("#message-block"))
        });
    </script>
{% endblock %}

{% block menu %}
    <div id="header">
        <div class="basic-div">
            <ul id="menu">
                <li>
                <span>
                    {% if user.first_name or user.last_name %}
                        {{ user.get_full_name }}
                    {% else %}
                        {{ user }}
                    {% endif %}
                </span>
                    <ul>
                        <li>
                        <span>
                            <a href="{% url 'logout' %}">Выйти</a>
                        </span>
                        </li>
                    </ul>
                </li>
                <li>
                    <span>Справочники</span>
                    <ul>
                        <li>
                            <span>
                                <a href="{% url 'products' %}">Товары</a>
                            </span>
                        </li>
                        <li>
                            <span>
                                <a href="{% url 'contractors' %}">Контрагенты</a>
                            </span>
                        </li>
                    </ul>
                </li>
                <li>
                    <span>Документы</span>
                    <ul>
                        <li>
                            <span>Приходные документы</span>
                        </li>
                        <li>
                            <span>Расходные документы</span>
                        </li>
                    </ul>
                </li>
                <li>
                    <span>Отчеты</span>
                    <ul>
                        <li>
                            <span>
                                <a href="{% url 'products_to_xls' %}">Список товаров (XLS)</a>
                            </span>
                        </li>
                        <li>
                            <span>
                                <a href="{% url 'contractors_to_xls' %}">Список контрагентов (XLS)</a>
                            </span>
                        </li>
                    </ul>
                </li>
                <li>
                    <span>Сервис</span>
                    <ul>
                        {% if user.is_superuser %}
                            <li>
                                <span>
                                    <a href="/admin/">Администрирование</a>
                                </span>
                            </li>
                        {% endif %}
                        <li>
                            <span>
                                <a href="{% url 'operations' %}">Журнал операций</a>
                            </span>
                        </li>
                        <li>
                            <span>
                                <a href="{% url 'storage_items' %}">Управление остатками</a>
                            </span>
                        </li>
                    </ul>
                </li>

            </ul>
        </div>
    </div>
{% endblock %}
